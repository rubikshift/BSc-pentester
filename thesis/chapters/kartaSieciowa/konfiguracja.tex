\subsection[Konfiguracja]{Konfiguracja}
Do skonfigurowania urządzenia wykonującego jako kartę sieciową wykorzystujemy wsparcie platformy dla \textit{usb gadget modes}. Jest to możliwe dzięki złączu Universal Serial Bus (USB) znajdującemu się na płytce Raspberry Pi Zero mogącemu pracować w trybie \textit{On-The-Go} (OTG). Oznacza to, że urządzenie może zmieniać swoją rolę pomiędzy \textit{host} i \textit{slave}. W przypadku działania urządzenia jako karta sieciowa potrzebny jest tryb \textit{slave}, który nazywany jest też \textit{device}. Konieczne są również odpowiednie moduły jądra systemu Linux dostarczone przez system \textit{Raspbian}, które za pomocą odpowiedniej konfiguracji zostają załadowane do systemu. W zależności, który z nich zostanie wybrany realizowana będzie inna funkcjonalność. W tym przypadku jest to g\_ether - ethernet gadget driver oraz dwc2 - sterownik zajmujący się obsługą funkcjonalności USB OTG.
Po załadowaniu wyżej wymienionych modułów możliwe jest korzystanie z interfejsu \textit{usb0}, jednak trzeba go skonfigurować. Nadajemy statyczny adres IP aby możliwe było późniejsze jednoznaczne odwoływanie się do niego (patrz listing~\ref{lst:ifconfig}).
\begin{lstlisting}[language=bash,caption={Konfiguracja interfejsu \textit{usb0}},label={lst:ifconfig}]
    ifconfig usb0 192.168.100.1 netmask 255.255.255.0 up
\end{lstlisting}
W celu automatycznej konfiguracji hosta z pomocą DHCP zastosowano serwer \textit{Dnsmasq}. Pozwala to na automatyczne przypisanie adresu IP do interfejsu,
do którego podpięty został kabel USB w testowanym komputerze. Do poprawnego działania serwera konieczne jest edytowanie pliku konfiguracyjnego \textit{/etc/dnsmasq.conf}.
Należy ustawić interfejs oraz adres IP, na którym nasłuchiwać mają usługi DHCP i DNS oraz pulę adresów IP (patrz listing~\ref{lst:dhcp}).\newpage
\begin{lstlisting}[language=bash,caption={Konfiguracja serwera DHCP},label={lst:dhcp}]
    interface=usb0
    listen-address=192.168.100.1
    dhcp-range=192.168.100.50,192.168.100.150,12h 
\end{lstlisting}
Następnie należy włączyć \textit{IP forwarding}, aby możliwe było przekazywanie pakietów pomiędzy interfejsami \textit{usb0} oraz \textit{wlan0}.
Konfigurujemy je za pomocą polecenia iptables, w którym określamy reguły przepływu pakietów (patrz listing~\ref{lst:iptables}). 
\begin{lstlisting}[language=bash,caption={Ustawianie reguł przepływu pakietów},label={lst:iptables}]
    iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
    iptables -A FORWARD -i wlan0 -o usb0 -m state --state RELATED,ESTABLISHED -j ACCEPT
    iptables -A FORWARD -i usb0 -o wlan0 -j ACCEPT 
\end{lstlisting}
\begin{enumerate}
    \item Wszystkie pakiety opuszczające urządzenie przez interfejs \textit{wlan0}, są poddawane operacji maskarady, która poprawia bezpieczeństwo ukrywając wewnętrzne adresy IP w danej sieci.
    \item Akceptacja przekazywania pakietów z interfejsu \textit{wlan0} do interfejsu \textit{usb0}
    \item Akceptacja przekazywania pakietów z interfejsu \textit{usb0} do interfejsu \textit{wlan0}
\end{enumerate}
