<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>Dashboard</title>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<script>
		function msg() {
			$.ajax({
				"url": "http://165.22.121.233:8888/api/dashboard/?jsonp=myCallback",
				"type": "GET",
				"dataType": "json",
				"contentType": "application/json",
				"jsonpCallback": "myCallback",
				"beforeSend": function () {
					document.getElementById('messages').innerHTML = "<div class=\"spinner-border text-primary\"></div>";
					return true;
				},
				"success": function (data) {
					var str = data.messages.replace("[", "").replace("]", "");
					var messages = str.split("'");
					var ext = data.externalIds.replace("[", "").replace("]", "");
					var externalIds = ext.split("'");
					var messagesContainer = document.getElementById('messages');

					table = "<table class=\"table table-hover\">";
					table += "<thead><tr><th>ID</th><th>MESSAGE</th></tr></thead><tbody>";
					for (index in messages) {
						if (!messages[index].includes(",") && messages[index].length > 2 &&  messages[index] != "kurwa gowno jebane"){
							table += "<tr><td>" + externalIds[index] + "</td><td>" + messages[index] + "</td></tr>";
						}
					}
					messagesContainer.innerHTML = table + "</tbody></table>";
				}
			})
		}

		$(document).ready(function () {
			$.ajax({
				"url": "http://165.22.121.233:8888/api/dashboard/active/?jsonp=myCallback",
				"type": "GET",
				"dataType": "json",
				"contentType": "application/json",
				"jsonpCallback": "myCallback",
				"beforeSend": function () {
					document.getElementById('activeRpi').innerHTML = "<div class=\"spinner-border text-warning\"></div>";
					return true;
				},
				"success": function (data) {
					var mess = data.messages.replace("[", "").replace("]", "");
					var messages = mess.split("'");

					var rpiContainer = document.getElementById('activeRpi');
					rpiContainer.innerHTML = "";
					for (index in messages) {
						if (!messages[index].includes(",") && messages[index].length > 2) {
							rpiContainer.innerHTML += "<li class=\"list-group-item\">" + messages[index] + "</li>";
						}
					}

				}
			})
		}
		);

		function send() {
			var payload = document.getElementById("payload").value;
			var externalId = document.getElementById("extId").value;
			if(payload == "" || externalId == "") {
				alert("PLEASE PROVIDE PAYLOAD AND EXTERNAL ID");
				return;
			}
			$.ajax({
				"url": "http://165.22.121.233:8888/api/dashboard/",
				"type": "POST",
				"dataType": "json",
				"data": '{"externalId":"' + externalId + '", "messages": "' + payload + '"}',
				"contentType": "application/json",
				"jsonpCallback": "myCallback",
				"success": function (response) {
					console.log(response);
				}
			})
		}

	</script>
</head>

<body class="container">
	<div class="row">
		<div class="col"></div>
		<div class="col">
			<h1>BSC PENTESTER</h1>
		</div>
		<div class="col"></div>
	</div>
	<div class="container">
		<div class="row">
			<div class="col">
				<h2>Form:</h2>
			</div>
			<div class="col"></div>
			<div class="col"></div>
		</div>
		<div class="row">
			<div class="col"></div>
			<div class="col">
				<form>
					<div class="form-group">
						<label for="payload">PAYLOAD</label>
						<input class="form-control" type="text" name="payload" id="payload"
							placeholder="{'example':'test'}" required>
					</div>
					<div class="form-group">
						<label for="externalId">RPI External ID</label>
						<input class="form-control" type="text" name="externalId" id="extId" placeholder="All" required>
					</div>
					<div class="form-group row">
						<div class="col"><input class="btn btn-success btn-block" type="button" value="send"
								onclick="send()">
						</div>
					</div>
				</form>
			</div>
			<div class="col"></div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			<div class="col">
				<h2>Active Rpi:</h2>
			</div>
			<div class="col"></div>
			<div class="col"></div>
		</div>
		<ul class="list-group list-group-flush" id="activeRpi">
		</ul>
	</div>
	<div class="container">
		<div class="row">
			<div class="col">
				<h2>Messages:</h2>
			</div>
			<div class="col">
				<form>
					<input type="button" class="btn btn-primary btn-block" value="load all messages" onclick="msg()">
				</form>
			</div>
			<div class="col"></div>

		</div>
		<div class="container" id="messages">
		</div>
	</div>
</body>

</html>