import time
import paho.mqtt.client as mqtt

def on_message(self,userdata,message):
    print("recive message=",str(message.payload.decode("utf-8")))
    if str(message.payload.decode("utf-8")) == '[{"name":"attack_name","data":"3100"}]':
        self.Send('[{"name":"receive","data":"0000"}]')

class Thing(mqtt.Client):
    def __init__(self,external_id, external_key, url):
        super(Thing, self).__init__()
        self.LoadConfig()
        self.username_pw_set( self.id , self.key)
        self.on_message=on_message
        self.connect(self.broker_address)
        
    def Start(self):
        self.loop_start()
        self.subscribe(topic = "channels/" + self.channel_sub_id + "/messages")
       
        
    def End(self):
        self.disconnect()
        self.loop_stop()
    
    def LoadConfig(self):
        self.broker_address = "165.22.121.233"
        self.id = "314ab3c5-41e0-4b96-becd-bc0899243fb0"
        self.key = "317e5873-34ab-41b7-ad95-c1c34e61ee3f"
        self.channel_sub_id = "cdd7c531-bc03-46ae-8852-8a2502a68463" 
        self.channel_pub_id = "2aed73b7-949c-4293-a2b2-d79d5019a1dd"
        
    def Send(self,payload):
        self.publish("channels/" + self.channel_pub_id + "/messages" , payload)


thing = Thing(1,1,"url")
thing.Start()
time.sleep(5)
thing.End();