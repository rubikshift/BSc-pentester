import time
import paho.mqtt.client as mqtt

class Thing:
    def __init__(self,external_id, external_key, url):
        #TODO dodać wysyłanie rządania z pobieraniem pełnej konfiguracji
        self.id = "314ab3c5-41e0-4b96-becd-bc0899243fb0"
        self.key = "317e5873-34ab-41b7-ad95-c1c34e61ee3f"
        self.channel_id = "2aed73b7-949c-4293-a2b2-d79d5019a1dd"

def on_message(client,userdata,message):
    #tutaj obsługa wiadomości
    print("recive message=",str(message.payload.decode("utf-8")))

thing = Thing(1,1,"url")
broker_address = "165.22.121.233"

client = mqtt.Client()
client.on_message=on_message
client.username_pw_set(thing.id, thing.key)
client.connect(broker_address)
client.loop_start()
client.subscribe(topic = "channels/" + thing.channel_id + "/messages")
time.sleep(20)
client.disconnect()
client.loop_stop()