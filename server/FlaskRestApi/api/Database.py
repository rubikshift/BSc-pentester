import pymongo


class Database:
    def __init__(self):
        self.client = pymongo.MongoClient("mongodb://localhost:27017/")
        self.db = self.client["rpiDatabase"]
        self.rpiList = self.db["rpiList4"]
        self.messages = self.db["rpiMessages2"]

    def AddNewRpi(self, data):
        self.rpiList.insert_one(data)

    def AddPayload(self, data):
        print(data)
        self.messages.insert_one(data)

    def GetAllPayload(self):
        query = {}
        return self.messages.find(query)

    def IsExist(self, externalId):
        query = {"externalId": externalId}
        result = self.rpiList.find(query)
        return result.count()

    def GetRpi(self, externalId):
        query = {"externalId": externalId}
        result = self.rpiList.find(query)
        return result[0]

    def GetAllPubChannels(self):
        result = self.rpiList.find({}, {"_id": 0, "channel_pub_id": 1})
        return result

    def GetAllSubChannels(self):
        result = self.rpiList.find({}, {"_id": 0, "channel_sub_id": 1})
        return result
