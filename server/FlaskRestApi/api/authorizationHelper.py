import subprocess
import json


def LogIn():
    userToken = subprocess.check_output(['mainflux-cli users token test@interia.pl 123'], shell = True)
    userToken = userToken.replace('(string) (len=183) "', '')
    userToken = userToken.replace('"', '')
    return userToken


def CreateThing(userToken, externalId):
    thingId = subprocess.check_output(["mainflux-cli things create '"+'{"name":"Thing'+externalId+'"}'+"' " + userToken], shell = True)
    thingId = thingId.replace('(string) (len=36) "', '')
    thingId = thingId.replace('"', '')
    thingId = thingId.replace('\n', '')
    return thingId


def GetKey(userToken, thingId):
    key = subprocess.check_output(["mainflux-cli things get "+thingId+" "+userToken],shell=True)
    start = key.find("Key: (string) (len=36)")
    stop = key.find("Metadata:")
    strObj = key[start + 24:stop-4:]
    return strObj


def CreateChannel(userToken, channelName):
    channelId = subprocess.check_output(["mainflux-cli channels create '"+'{"name":"'+channelName+'"}'+"' " + userToken], shell = True)
    channelId = channelId.replace('(string) (len=36) "', '')
    channelId = channelId.replace('"', '')
    channelId = channelId.replace('\n', '')
    return channelId


def ConnectToChannel(userToken, channelId, id):
    subprocess.check_output(["mainflux-cli things connect "+id +" "+ channelId + " "+ userToken], shell = True)
