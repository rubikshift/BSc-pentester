import os
import sys
from datetime import datetime
from subprocess import Popen, PIPE


def log(*args):
    for arg in args:
        if arg is not None:
            print(f"{datetime.now()}\t{arg}")


def getRootPrivileges():
    if os.geteuid() != 0:
        log("Root required, getting privileges")
        os.execvp('sudo', ['sudo', 'python3'] + sys.argv)


def writeFile(path, text, mode):
    with open(path, mode) as opened_file:
        opened_file.write(text)


def activateModules(*args):
    output, error = Popen(
        ["modprobe", "--all"] + list(args),
        stdout=PIPE,
        stderr=PIPE
    ).communicate()
    if error:
        log(error.decode("utf-8"))


def aptInstall(*requirements):
    if len(requirements) == 0:
        raise RuntimeError

    log("Update")
    output, error = Popen(
            ["apt-get", "update", "-y"],
            stdout=PIPE,
            stderr=PIPE
        ).communicate()
    if error:
        log(error.decode("urf-8"))

    for requirement in requirements:
        log(f"Install {requirement}")
        output, error = Popen(
                ["apt-get", "install", "-y", requirement],
                stdout=PIPE,
                stderr=PIPE
            ).communicate()
        if error:
            log(error.decode("utf-8"))

