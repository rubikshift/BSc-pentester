import os
from subprocess import Popen, PIPE
from lib import systemUtils as utils
from lib.usb.device import Device


class Keyboard(Device):
    def _customConfig(self, *args, **kwargs):
        path = os.path.join(self._path, "functions", "hid.usb0")
        os.makedirs(path, exist_ok=True)

        with open(os.path.join(path, "protocol"), 'w') as file:
            file.write("1")
        
        with open(os.path.join(path, "subclass"), 'w') as file:
            file.write("1")
        
        with open(os.path.join(path, "report_length"), 'w') as file:
            file.write("8")
        
        with open(os.path.join(path, "report_desc"), 'wb') as file:
            file.write(b"\x05\x01\x09\x06\xa1\x01\x05\x07\x19\xe0\x29\xe7\x15\x00\x25\x01\x75\x01\x95\x08\x81\x02\x95\x01\x75\x08\x81\x03\x95\x05\x75\x01\x05\x08\x19\x01\x29\x05\x91\x02\x95\x01\x75\x03\x91\x03\x95\x06\x75\x08\x15\x00\x25\x65\x05\x07\x19\x00\x29\x65\x81\x00\xc0")

        os.symlink(
            path,
            os.path.join(self._path, "configs", "c.1", "hid.usb0")
        )
