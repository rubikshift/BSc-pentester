import os
from subprocess import Popen, PIPE
from lib import systemUtils as utils
from lib.usb.device import Device


class Ether(Device):
    def __init__(self, name, idVendor, idProduct,
                 serial, manufacturer, product, *args, **kwargs):
        super().__init__(name, idVendor, idProduct,
                         serial, manufacturer, product, *args, **kwargs)

    def _customConfig(self, hostMac, selfMac):
        path = os.path.join(self._path, "functions", "ecm.usb0")
        os.makedirs(path, exist_ok=True)

        with open(os.path.join(path, "host_addr"), 'w') as file:
            file.write(hostMac)

        with open(os.path.join(path, "dev_addr"), 'w') as file:
            file.write(selfMac)

        os.symlink(
            path,
            os.path.join(self._path, "configs", "c.1", "ecm.usb0")
        )
